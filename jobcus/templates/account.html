{# templates/account.html #}
{% extends "base.html" %}

{% block title %}Jobcus – Sign In / Sign Up{% endblock %}
{% block body_class %}account-page{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
{% endblock %}

{% block content %}
<section class="auth-wrapper">
  <div class="auth-card auth-card--blue">

    <h2 class="auth-title" data-auth-mode-label>
      {% if mode == 'login' %}
        Sign in to your account
      {% else %}
        Create your account
      {% endif %}
    </h2>
    <p class="auth-subtitle">
      {% if mode == 'login' %}
        Good to see you again! Welcome back.
      {% else %}
        Create a free account to get started.
      {% endif %}
    </p>

    <!-- Flash messages -->
    <div id="flashMessages" class="flash-message">
      {% for msg in get_flashed_messages() %}
        <div class="flash-item">{{ msg }}</div>
      {% endfor %}
    </div>

    <!-- Auth alerts populated by account.js -->
    <div id="auth-error" class="flash-item error" hidden></div>
    <div id="auth-success" class="flash-item success" hidden></div>

    <form id="auth-form" class="auth-form" autocomplete="on">
      {# Name (shown in Sign Up mode) #}
      <div class="form-group" id="name-wrap" style="display:none;">
        <label for="full_name">Full Name</label>
        <input type="text" id="full_name" name="full_name" placeholder="Your full name" />
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Enter your password" required />
      </div>

      <button type="submit" class="btn-primary" id="submit-btn">
        {% if mode=='login' %}Sign In{% else %}Create Account{% endif %}
      </button>

      <p class="toggle-text">
        <span id="togglePrompt">
          {% if mode=='login' %}
            Don’t have an account?
          {% else %}
            Already have an account?
          {% endif %}
        </span>
        <a href="#" id="switch-to-signup" class="toggle-link" {% if mode!='login' %}style="display:none;"{% endif %}>Sign Up</a>
        <a href="#" id="switch-to-signin" class="toggle-link" {% if mode=='login' %}style="display:none;"{% endif %}>Sign In</a>
      </p>

      <p class="text-sm">
        <a href="{{ url_for('forgot_password') }}">Forgot your password?</a>
      </p>

      <div class="or-divider"><span>OR</span></div>

      <div class="social-buttons">
        <button type="button" class="social-btn fb">
          <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
        </button>
        <button type="button" class="social-btn google">
          <img src="{{ url_for('static', filename='icons/google.png') }}" alt="Google">
        </button>
        <button type="button" class="social-btn linkedin">
          <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
        </button>
        <button type="button" class="social-btn apple">
          <img src="{{ url_for('static', filename='icons/apple.svg') }}" alt="Apple">
        </button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

{% block extra_js %}
  <!-- Inject Supabase config from Flask -->
  <script>
    (function () {
      const url = {{ (config.get('SUPABASE_URL') or current_app.config.get('SUPABASE_URL') or '')|tojson }};
      const key = {{ (config.get('SUPABASE_ANON_KEY') or current_app.config.get('SUPABASE_ANON_KEY') or '')|tojson }};
      const postLogin = {{ (config.get('POST_LOGIN_REDIRECT') or current_app.config.get('POST_LOGIN_REDIRECT') or '/dashboard')|tojson }};
      window.SUPABASE_URL = url;
      window.SUPABASE_ANON_KEY = key;
      window.POST_LOGIN_REDIRECT = postLogin;
      if (!url || !key) {
        window.__SUPABASE_MISSING__ = true;
        console.warn("Supabase URL/ANON KEY missing in config.");
      }
    })();
  </script>

  <!-- Load Supabase SDK BEFORE account.js; defer preserves order -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
{% endblock %}

{% block scripts %}
  <!-- Your auth logic (the new, fetch-free version) -->
  <script src="{{ url_for('static', filename='js/account.js') }}" defer></script>
{% endblock %}
