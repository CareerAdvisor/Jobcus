{# templates/account.html #}
{% extends "base.html" %}

{% block title %}Jobcus – Sign In / Sign Up{% endblock %}
{% block body_class %}account-page{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
{% endblock %}

{% block content %}
<section class="auth-wrapper">
  <div class="auth-card auth-card--blue">

    <h2 class="auth-title">
      {{ 'Sign In to<br>Jobcus'|safe if mode == 'login' else 'Sign Up to<br>Jobcus'|safe }}
    </h2>
    <p class="auth-subtitle">
      {{ 'Good to see you again! Welcome back.' if mode == 'login' else 'Create a free account to get started.' }}
    </p>

    <div id="flashMessages" class="flash-message">
      {% for msg in get_flashed_messages() %}
        <div class="flash-item">{{ msg }}</div>
      {% endfor %}
    </div>

    <form id="accountForm" class="auth-form" autocomplete="on">
      <input type="hidden" name="mode" id="mode" value="{{ mode }}" />

      <div class="form-group" id="nameGroup" {{ '' if mode != 'login' else 'style="display:none"'|safe }}>
        <label for="name">Full Name</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="Your full name"
          autocomplete="name"
        />
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="you@example.com"
          required
          autocomplete="email"
          autocapitalize="none"
          spellcheck="false"
          inputmode="email"
        />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="Enter your password"
          required
          autocomplete="{{ 'current-password' if mode == 'login' else 'new-password' }}"
        />
      </div>

      <!-- Cloudflare Turnstile (checkbox style, user must click) -->
      <div id="cfWidget"
           class="cf-turnstile"
           data-sitekey="{{ turnstile_site_key or '' }}"
           data-appearance="interaction-only"
           data-refresh-expired="auto"
           data-callback="onTurnstileToken"
           data-error-callback="onTurnstileError"
           data-timeout-callback="onTurnstileTimeout">
      </div>

      <button type="submit" class="btn-primary" id="submitButton">
        {% if mode=='login' %}Sign In{% else %}Sign Up{% endif %}
      </button>

      <p class="toggle-text">
        <span id="togglePrompt">
          {% if mode=='login' %}
            Don’t have an account?
          {% else %}
            Already have an account?
          {% endif %}
        </span>
        <a href="#" id="toggleMode" class="toggle-link">
          {% if mode=='login' %}Sign Up{% else %}Sign In{% endif %}

        </a>
      </p>

      <div class="or-divider"><span>OR</span></div>

      <div class="social-buttons">
        <button type="button" class="social-btn fb">
          <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
        </button>
        <button type="button" class="social-btn google">
          <img src="{{ url_for('static', filename='icons/google.png') }}" alt="Google">
        </button>
        <button type="button" class="social-btn linkedin">
          <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
        </button>
        <button type="button" class="social-btn apple">
          <img src="{{ url_for('static', filename='icons/apple.svg') }}" alt="Apple">
        </button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

{% block scripts %}
  <!-- Turnstile loader -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <script>
    // Gate the submit button on a real Turnstile token (user click)
    window.turnstileToken = null;
    function onTurnstileToken(token){
      window.turnstileToken = token;
      document.getElementById('submitButton').disabled = false;
    }
    function onTurnstileError(){
      window.turnstileToken = null;
      document.getElementById('submitButton').disabled = true;
    }
    function onTurnstileTimeout(){
      window.turnstileToken = null;
      document.getElementById('submitButton').disabled = true;
      try { turnstile.reset('#cfWidget'); } catch(e){}
    }
  </script>

  <script src="{{ url_for('static', filename='js/account.js') }}"></script>
{% endblock %}
