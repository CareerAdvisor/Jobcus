{# templates/account.html #}
{% extends "base.html" %}

{% block title %}Jobcus – Sign In / Sign Up{% endblock %}
{% block body_class %}account-page{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/account.css') }}">
{% endblock %}

{% block content %}
{% set is_login = (mode == 'login') %}
<section class="auth-wrapper">
  <div class="auth-card auth-card--blue">

    <h2 class="auth-title">
      {% if is_login %}
        {{ 'Sign In to<br>Jobcus'|safe }}
      {% else %}
        {{ 'Sign Up to<br>Jobcus'|safe }}
      {% endif %}
    </h2>
    <p class="auth-subtitle">
      {% if is_login %}
        Good to see you again! Welcome back.
      {% else %}
        Create a free account to get started.
      {% endif %}
    </p>

    <div id="flashMessages" class="flash-message">
      {% with msgs = get_flashed_messages() %}
        {% if msgs %}
          {% for msg in msgs %}
            <div class="flash-item">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

    <form id="accountForm" class="auth-form" autocomplete="on" novalidate>
      <input type="hidden" name="mode" id="mode" value="{{ 'login' if is_login else 'signup' }}">

      <!-- Full Name (only show when signing up) -->
      <div class="form-group" id="nameGroup" {% if is_login %}style="display:none"{% endif %}>
        <label for="name">Full Name</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="Your full name"
          autocomplete="name"
        />
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="you@example.com"
          required
          autocomplete="email"
          autocapitalize="none"
          spellcheck="false"
          inputmode="email"
        />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        {% if is_login %}
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Enter your password"
            required
            autocomplete="current-password"
          />
        {% else %}
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Create a password"
            required
            autocomplete="new-password"
          />
        {% endif %}
      </div>

      <!-- Cloudflare Turnstile (checkbox) -->
      <div class="form-group">
        <div
          id="cfWidget"
          class="cf-turnstile"
          data-sitekey="{{ turnstile_site_key }}"
          data-callback="onTurnstileToken"
          data-error-callback="onTurnstileError"
          data-timeout-callback="onTurnstileTimeout"
          data-theme="auto"
          data-size="normal"
          data-appearance="always">
        </div>
        <noscript>
          <p style="color:#b42318;margin-top:8px;">JavaScript is required to complete the CAPTCHA.</p>
        </noscript>
      </div>

      <button type="submit" class="btn-primary" id="submitButton" disabled>
        {% if is_login %}Sign In{% else %}Sign Up{% endif %}
      </button>

      <p class="toggle-text">
        <span id="togglePrompt">
          {% if is_login %}
            Don’t have an account?
          {% else %}
            Already have an account?
          {% endif %}
        </span>
        <a href="#" id="toggleMode" class="toggle-link">
          {% if is_login %}Sign Up{% else %}Sign In{% endif %}
        </a>
      </p>

      <div class="or-divider"><span>OR</span></div>

      <div class="social-buttons">
        <button type="button" class="social-btn fb" aria-label="Continue with Facebook">
          <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
        </button>
        <button type="button" class="social-btn google" aria-label="Continue with Google">
          <img src="{{ url_for('static', filename='icons/google.png') }}" alt="Google">
        </button>
        <button type="button" class="social-btn linkedin" aria-label="Continue with LinkedIn">
          <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
        </button>
        <button type="button" class="social-btn apple" aria-label="Continue with Apple">
          <img src="{{ url_for('static', filename='icons/apple.svg') }}" alt="Apple">
        </button>
      </div>
    </form>
  </div>
</section>
{% endblock %}

{% block scripts %}
  {# Load Turnstile ONCE, here (don’t also include it inside the form) #}
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script src="{{ url_for('static', filename='js/account.js') }}"></script>
{% endblock %}
