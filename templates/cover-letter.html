{% extends "base.html" %}
{% block title %}Cover Letter – Jobcus{% endblock %}

{% set is_paid  = current_user.is_authenticated and (current_user.plan|lower in ['standard','premium']) %}
{% set wm_text  = '' if is_paid else 'JOBCUS.COM' %}

{% block content %}
<main id="cover-letter" class="rb-wrap">
  <!-- Hero -->
  <div class="hero-wrap">
    <section class="interview-hero-with-image hero">
      <h5 class="hero-kicker">AI COVER LETTER</h5>
      <h1 class="hero-title">
        Create a tailored <span class="accent">cover letter</span>
      </h1>
      <p class="hero-subtitle">
        Use your resume details to draft a polished letter.
      </p>
    </section>
  </div>

  <!-- 70% width layout (see cover-letter.css) -->
  <div class="cl-container rb-layout">
    <!-- Left: Wizard form -->
    <div class="rb-main">
      <form id="clForm" class="rb-form" autocomplete="on">
        <!-- STEP 1: Recruiter -->
        <section class="rb-step active">
          <article class="rb-card">
            <header>
              <h2>Recruiter</h2>
              <p>Company, role, job link, tone, and recipient details.</p>
            </header>
            <div class="rb-panel">
              <div class="rb-grid">
                <label>Company
                  <input type="text" name="company" placeholder="Acme Inc.">
                </label>
                <label>Role
                  <input type="text" name="role" placeholder="IT Support">
                </label>
                <label class="full">Job link (optional)
                  <input type="url" name="jobUrl" placeholder="https://…">
                </label>
                <label class="full">Tone
                  <select name="tone">
                    <option value="professional" selected>Professional</option>
                    <option value="friendly">Friendly</option>
                    <option value="concise">Concise</option>
                  </select>
                </label>
                <label class="full">Recruiting Manager or Team
                  <input type="text" name="recipient" placeholder="Hiring Manager">
                </label>

                <!-- (Removed the “Recipient’s address” helper line) -->
                <label class="full">Company address (line 1)
                  <input type="text" name="companyAddress1" placeholder="45 Market Road">
                </label>
                <label>City
                  <input type="text" name="companyCity" placeholder="London">
                </label>
                <label>Postcode
                  <input type="text" name="companyPostcode" placeholder="W1 2BC">
                </label>
              </div>
            </div>
          </article>
        </section>

        <!-- STEP 2: Applicant -->
        <section class="rb-step">
          <article class="rb-card">
            <header>
              <h2>Applicant</h2>
              <p>Your contact details for the letter heading.</p>
            </header>
            <div class="rb-panel">
              <div class="rb-grid">
                <label>First name <input type="text" name="firstName" placeholder="John"></label>
                <label>Last name  <input type="text" name="lastName"  placeholder="Doe"></label>
                <label class="full">Your address (line 1)
                  <input type="text" name="senderAddress1" placeholder="123 High Street">
                </label>
                <label>City
                  <input type="text" name="senderCity" placeholder="London">
                </label>
                <label>Postcode
                  <input type="text" name="senderPostcode" placeholder="E1 1AA">
                </label>
                <label>Email
                  <input type="email" name="senderEmail" placeholder="you@email.com">
                </label>
                <label>Phone
                  <input type="tel" name="senderPhone" placeholder="+44 7123 456 789">
                </label>
                <label>Date
                  <input type="date" name="letterDate">
                </label>
              </div>
            </div>
          </article>
        </section>

        <!-- STEP 3: Letter body + AI -->
        <section class="rb-step">
          <article class="rb-card">
            <header>
              <h2>Letter body</h2>
              <p>Write your letter or let AI draft one you can edit.</p>
            </header>
            <div class="rb-panel">
              <textarea name="body" rows="12" placeholder="Write or generate your letter body here…"></textarea>

              <div class="ai-suggest" id="ai-cl" data-field="cover_letter">
                <div class="ai-title">✦ Write with AI</div>
                <p class="ai-text">We’ll draft a tailored letter using your details above.</p>
                <div class="ai-actions">
                  <button type="button" class="btn ai-refresh">Refresh</button>
                  <button type="button" class="btn btn-primary ai-add">Insert</button>
                </div>
              </div>
            </div>
          </article>
        </section>

        <!-- Wizard controls -->
        <footer class="rb-footer">
          <button type="button" id="rb-back" class="ghost">← Back</button>

          <div class="rb-row">
            <button type="button" id="cl-preview" class="cta-secondary">Preview</button>
            <button type="button" id="rb-next" class="cta-primary">Next</button>
          </div>
        </footer>
      </form>
    </div>

    <!-- Right: sticky preview + downloads -->
    <aside class="rb-preview">
      <article class="rb-card">
        <div class="rb-panel">
          <div id="clPreviewWrap" class="preview-wrap" style="display:none;"
               {% if wm_text %} data-watermark="{{ wm_text }}"{% endif %}>
            <iframe id="clPreview" style="width:100%;height:80vh;border:0;background:#fff;"></iframe>
          </div>
    
          <!-- inside <aside class="rb-preview"> ... -->
          <div id="cl-downloads" class="rb-actions" style="display:none;margin-top:10px;">
            <button type="button" id="cl-back-edit" class="ghost" style="display:none;">← Back to edit</button>
            <button type="button" id="cl-download-pdf"  class="cta-secondary">⬇️ Download PDF</button>
            <button type="button" id="cl-download-docx" class="cta-secondary">⬇️ Download Word</button>
          </div>
        </div>
      </article>
    </aside>
  </div>
</main>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cover-letter.css') }}">
<script defer src="{{ url_for('static', filename='js/cover-letter.js') }}"></script>
{% endblock %}
