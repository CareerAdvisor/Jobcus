{% extends "base.html" %}
{% block title %}Resume Builder – Jobcus{% endblock %}

{% block content %}

<!-- Top tabs (mobile-first) -->
<nav class="rb-tabs" role="tablist" aria-label="Resume builder steps">
  <button class="active" data-target="#write"  role="tab" aria-controls="write"  aria-selected="true">Write</button>
  <button data-target="#design" role="tab" aria-controls="design" aria-selected="false">Design</button>
</nav>

<main id="resume-builder" class="rb-wrap">
  <form id="resumeForm" class="rb-form">

    <!-- WRITE -->
    <section id="write" class="rb-step active" role="tabpanel" aria-labelledby="h-write">
      <!-- Personal details -->
      <article class="rb-card">
        <header>
          <h2 id="h-personal">Personal details</h2></br>
          <p>Give recruiters a quick overview.</p>
        </header>

        <div class="rb-panel">
          <div class="rb-grid">
            <label>First name
              <input type="text" name="firstName" required>
            </label>
            <label>Last name
              <input type="text" name="lastName">
            </label>
            <label class="full">Job title
              <input type="text" name="title" placeholder="e.g., IT Support Specialist">
            </label>
          </div>

          <details class="rb-disclosure" style="margin-top:12px;">
            <summary>Show additional details</summary>
            <div class="rb-grid" style="margin-top:.5rem;">
              <label>Nationality <input type="text" name="nationality"></label>
              <label>Driver’s licence <input type="text" name="drivers"></label>
              <label class="full">Birth date <input type="date" name="dob"></label>
            </div>
          </details>
        </div>
      </article>

      <!-- Contact information -->
      <article class="rb-card">
        <header>
          <h2 id="h-contact">Contact information</h2></br>
          <p>Make it easy to reach you.</p>
        </header>

        <div class="rb-panel">
          <div class="rb-grid">
            <label class="full">Email <input type="email" name="email"></label>
            <label class="full">Phone <input type="tel" name="phone"></label>
            <label>Country <input type="text" name="country"></label>
            <label>City <input type="text" name="city"></label>
            <label class="full">Address <input type="text" name="address"></label>
            <label>Postcode <input type="text" name="postcode"></label>
            <label class="full">LinkedIn / Portfolio <input type="url" name="portfolio"></label>
          </div>
        </div>
      </article>

      <!-- Professional summary (with AI) -->
      <article class="rb-card">
        <header>
          <h2 id="h-summary">Professional Summary (with AI)</h2> </br>
          <p>1–3 crisp sentences with measurable wins.</p>
        </header>

        <div class="rb-panel">
          <textarea name="summary" rows="5" placeholder="e.g., IT Support Specialist with 5+ years..."></textarea>

          <div class="ai-suggest" id="ai-summary" data-field="summary" style="margin-top:12px;">
            <div class="ai-title">✦ Write with AI</div>
            <p class="ai-text">We’ll fetch a tailored suggestion based on what you’ve entered so far…</p>
            <div class="ai-actions">
              <button type="button" class="btn ai-refresh" data-ai="summary">Refresh</button>
              <button type="button" class="btn btn-primary ai-add">Add</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Employment history (with AI highlights) -->
      <article class="rb-card" data-repeater="experience">
        <header>
          <h2 id="h-experience">Employment history</h2></br>
          <p>Use action verbs and numbers.</p>
        </header>

        <div class="rb-panel">
          <template id="tpl-experience">
            <div class="rb-item">
              <div class="rb-grid">
                <label class="full">Job title <input type="text" name="role"></label>
                <label class="full">Company name <input type="text" name="company"></label>
                <label>Start date <input type="text" name="start" placeholder="Jan 2021"></label>
                <label>End date <input type="text" name="end" placeholder="Present"></label>
                <label class="full">Location <input type="text" name="location"></label>
              </div>

              <label class="full" style="margin-top:12px;">Highlights (one per line)
                <textarea name="bullets" rows="4" placeholder="• Reduced ticket backlog by 32%..."></textarea>
              </label>

              <div class="ai-suggest" data-field="bullets" style="margin-top:12px;">
                <div class="ai-title">✦ Write with AI</div>
                <p class="ai-text">Get role-specific bullet ideas for this job.</p>
                <div class="ai-actions">
                  <button type="button" class="btn ai-refresh" data-ai="highlights">Refresh</button>
                  <button type="button" class="btn btn-primary ai-add">Add</button>
                </div>
              </div>

              <div class="rb-actions" style="padding-top:10px;">
                <button type="button" class="rb-remove">Remove</button>
              </div>
            </div>
          </template>

          <div class="rb-list" id="exp-list"></div>
          <button type="button" class="rb-add" data-add="experience">+ Add another experience</button>
        </div>
      </article>

      <!-- Skills -->
      <article class="rb-card">
        <header>
          <h2 id="h-skills">Skills</h2></br>
          <p>Most relevant skills first.</p>
        </header>

        <div class="rb-panel">
          <div class="rb-chip-input">
            <input type="text" id="skillInput" placeholder="Type a skill and press Enter">
            <div id="skillChips" class="rb-chips" style="margin-top:8px;"></div>
            <input type="hidden" name="skills"> <!-- comma-separated -->
          </div>
        </div>
      </article>

      <!-- Education -->
      <article class="rb-card" data-repeater="education">
        <header>
          <h2 id="h-education">Education</h2></br>
        </header>

        <div class="rb-panel">
          <template id="tpl-education">
            <div class="rb-item">
              <div class="rb-grid">
                <label class="full">Institution <input type="text" name="school"></label>
                <label class="full">Degree <input type="text" name="degree"></label>
                <label>Start date <input type="text" name="graduatedStart" placeholder="Sep 2017"></label>
                <label>End date <input type="text" name="graduated" placeholder="Jun 2021"></label>
                <label class="full">Location <input type="text" name="location"></label>
              </div>
              <div class="rb-actions" style="padding-top:10px;">
                <button type="button" class="rb-remove">Remove</button>
              </div>
            </div>
          </template>

          <div class="rb-list" id="edu-list"></div>
          <button type="button" class="rb-add" data-add="education">+ Add education</button>
        </div>
      </article>
    </section>

    <!-- DESIGN -->
    <section id="design" class="rb-step" role="tabpanel" aria-labelledby="h-design" hidden>
      <article class="rb-card">
        <header><h2 id="h-design">Design</h2><p>Pick a template.</p></header>

        <div class="rb-panel">
          <label>Theme
            <select id="themeSelect" name="theme">
              <option value="modern" selected>Modern</option>
              <option value="minimal">Minimal</option>
            </select>
          </label>
          <div class="rb-row">
            <button type="button" id="previewTemplate" class="cta-secondary">Preview</button>
            <button type="button" id="downloadTemplatePdf" class="cta-primary">Download PDF</button>
          </div>

          <div id="resumePreviewWrap" style="display:none; margin-top:1rem;">
            <h3>Preview</h3>
            <iframe id="resumePreview" class="resume-preview" style="width:100%; height:100vh; border:0; background:#fff;"></iframe>
          </div>
        </div>
      </article>
    </section>

    <!-- Sticky footer controls -->
    <footer class="rb-footer">
      <button type="button" id="rb-back" class="ghost">Back</button>
      <button type="submit" id="rb-generate" class="cta-primary">Generate Resume</button>
      <button type="button" id="rb-next" class="cta-secondary">Next</button>
    </footer>
  </form>
</main>

{% endblock %}

{% block scripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="{{ url_for('static', filename='js/resume-builder.js') }}"></script>
{% endblock %}
