{% extends "base.html" %}

{% block title %}My Dashboard â€“ Jobcus{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<section class="dash-wrap">
  <h1 id="dashboardGreeting" class="dashboard-title"></h1>
  <p class="dashboard-subtitle">Track your career growth and insights powered by Jobcus AI.</p>

  <div class="top-stack">
    <!-- Score card -->
    <div class="dashboard-card score-card" id="resume-score-card" style="display:none;">
      <div class="score-card__head">
        <h3>ğŸ“„ Resume Score</h3>
        <button id="openReanalyze" class="btn btn-outline">Analyze updated resume</button>
      </div>

      <div class="score-card__body">
        <!-- score ring -->
        <div class="ring-wrap">
          <div class="progress-circle" data-score="0">
            <svg viewBox="0 0 36 36" class="ring">
              <path class="ring-track"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
              <path class="ring-progress" stroke-dasharray="0,100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
              <text x="18" y="20.35" class="ring-text" text-anchor="middle">0%</text>
            </svg>
          </div>
          <p id="metric-note" class="metric-note">Last analyzed: just now</p>
        </div>

        <!-- ATS breakdown -->
        <div class="ats-wrap">
          <h4>ATS Readiness</h4>
          <div id="ats-grid" class="ats-grid"><!-- filled by JS --></div>
          <small class="ats-hint">Higher is better. Aim for green across the board.</small>
        </div>
      </div>
    </div>

    <!-- Upload / re-analyze -->
    <div class="dashboard-card upload-card">
      <h3>Analyze a resume</h3>
      <p class="upload-card__sub">Upload a PDF/DOCX. Optionally add a job description to check keyword match.</p>

      <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload resume">
        <svg class="dz-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"
             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 15.75a4.5 4.5 0 0 0 4.5 4.5h9a4.5 4.5 0 0 0 .9-8.91A6 6 0 1 0 6.75 9" />
          <path d="M12 12v8M9 14l3-3 3 3" />
        </svg>
        <div class="dz-title">Browse Files</div>
        <p class="dz-sub">Drag and drop files here</p>
        <div id="dzFileName" class="dz-file" style="display:none;"></div>
        <input id="dashResumeFile" type="file" accept=".pdf,.docx" hidden>
      </div>

      <textarea id="dashJobDesc" class="textarea"
        placeholder="Optional: paste job description to check keywordsâ€¦"></textarea>

      <div class="upload-actions">
        <button id="dashAnalyzeBtn" class="btn btn-primary">Analyze resume</button>
        <span id="dashAnalyzing" class="analyzing">ğŸ¤– Analyzingâ€¦</span>
      </div>

      <small class="upload-note">Weâ€™ll store your latest result on this device for quick access.</small>
    </div>
  </div>

  <!-- Empty state -->
  <div id="no-analysis-cta" class="empty-state">
    <p>You havenâ€™t analyzed a resume yet. Use the upload panel above to get started.</p>
  </div>

  <!-- Detailed analysis -->
  <section id="resume-analysis" class="analysis-section" style="display:none;">
    <h2>ğŸ” Detailed Findings & Recommendations</h2>

    <div class="opt-panels">
      <div id="kw-panel" class="panel" style="display:none;">
        <h3>ğŸ¯ Job Keyword Match</h3>
        <div class="panel-split">
          <div>
            <h4>Matched</h4>
            <ul id="kw-matched" class="list"></ul>
          </div>
          <div>
            <h4>Missing</h4>
            <ul id="kw-missing" class="list"></ul>
          </div>
        </div>
      </div>

      <div id="sections-panel" class="panel" style="display:none;">
        <h3>ğŸ“‹ Resume Sections</h3>
        <div class="panel-split">
          <div>
            <h4>Present</h4>
            <ul id="sec-present" class="list"></ul>
          </div>
          <div>
            <h4>Missing</h4>
            <ul id="sec-missing" class="list"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <h3>âš ï¸ Issues Found</h3>
      <ul id="top-issues" class="list"></ul>
    </div>

    <div class="panel">
      <h3>âœ… What You Did Well</h3>
      <ul id="good-points" class="list"></ul>
    </div>

    <div class="panel">
      <h3>ğŸ’¡ Suggestions</h3>
      <ul id="suggestions-list" class="list"></ul>
    </div>

    <div class="opt-cta">
      <p>Want us to apply these fixes automatically? âœ¨</p>
      <button id="optimize-btn" class="btn btn-primary">Optimize My Resume</button>
    </div>

    <div class="opt-output">
      <div id="optimized-loading" class="loading">ğŸ¤– Optimizing your resume, please waitâ€¦</div>
      <pre id="optimized-output" class="output"></pre>

      {% if current_user.is_authenticated %}
        <div id="optimized-downloads" class="downloads">
          <button onclick="downloadOptimizedResume('pdf')" class="btn">â¬‡ï¸ Download PDF</button>
          <button onclick="downloadOptimizedResume('txt')" class="btn">â¬‡ï¸ Download TXT</button>
        </div>
      {% else %}
        <div class="downloads">
          <p>To download your optimized resume,
            <strong><a href="/account">Sign up or log in</a></strong>.
          </p>
        </div>
      {% endif %}
    </div>
  </section>
</section>
{% endblock %}

{% block scripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.1/docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
