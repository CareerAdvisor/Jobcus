{% extends "base.html" %}

{% block title %}My Dashboard – Jobcus{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<section class="dash-shell">
  <h1 id="dashboardGreeting" class="dash-title"></h1>
  <p class="dash-subtitle">Track your career growth and insights powered by Jobcus AI.</p>

  <!-- NUDGE: appears after 3 free analyses for anonymous users -->
  <div id="registerNudge" class="nudge" style="display:none">
    <strong>Enjoying the analyzer?</strong>
    You’ve used your 3 free analyses. Create a free account to save history and unlock more features.
    <a class="btn btn-primary" href="/account">Create account</a>
    <button class="btn-link" id="dismissNudge" aria-label="dismiss">Dismiss</button>
  </div>

  <!-- ===== Score card + Upload (stacked, centered) ===== -->
  <div class="dash-stack">
    <!-- Upload card -->
    <article class="card upload-card">
      <h3 class="upload-title">Upload a PDF/DOCX. Optionally add a job description to check keyword match.</h3>

      <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Browse files, drag and drop files here">
        <div class="dropzone__cloud" aria-hidden="true"></div>
        <div class="dropzone__title">Browse Files</div>
        <div class="dropzone__hint">Drag and drop files here</div>
        <input id="dashResumeFile" type="file" accept=".pdf,.docx" hidden>
      </div>
      <div id="fileName" class="file-name" aria-live="polite"></div>

      <label class="field">
        <span class="field__label sr-only">Job description (optional)</span>
        <textarea id="dashJobDesc" class="textarea" placeholder="Optional: paste job description to check keywords…"></textarea>
      </label>

      <label class="field">
        <span class="field__label center">Or pick a target role to assess relevance</span>
      
        <input id="dashRoleSelect" class="select"
               list="roleList"
               placeholder="Start typing a role (e.g., Business Analyst, Azure Architect, Animator)…" />
      
        <datalist id="roleList"></datalist>
      </label>

      <div class="actions">
        <button id="dashAnalyzeBtn" class="btn btn-primary" disabled>Analyze resume</button>
        <span id="dashAnalyzing" class="loading" style="display:none;">Analyzing…</span>
      </div>

      <p class="help">We’ll store your latest result on this device for quick access.</p>
    </article>

    <!-- Score card -->
    <article class="card score-card" id="resume-score-card" aria-live="polite" style="display:none">
      <div class="score-card__top">
        <div class="score-card__icon" aria-hidden="true"></div>
        <button id="openReanalyze" class="btn btn-outline">Analyze updated resume</button>
      </div>

      <div class="score-card__body">
        <div class="ring" role="img" aria-label="Resume score">
          <svg viewBox="0 0 120 120">
            <circle class="ring__track" cx="60" cy="60" r="52"></circle>
            <circle class="ring__progress" cx="60" cy="60" r="52" stroke-dasharray="0 400"></circle>
            <text x="60" y="68" class="ring__label">0%</text>
          </svg>
        </div>

        <div class="metrics">
          <div class="metric">
            <div class="metric__head"><span>Formatting</span><strong id="mFormatting">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bFormatting"></div></div>
          </div>

          <div class="metric">
            <div class="metric__head"><span>Sections</span><strong id="mSections">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bSections"></div></div>
          </div>

          <!-- NEW: Keywords -->
          <div class="metric">
            <div class="metric__head"><span>Keywords</span><strong id="mKeywords">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bKeywords"></div></div>
          </div>

          <div class="metric">
            <div class="metric__head"><span>Readability</span><strong id="mReadability">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bReadability"></div></div>
          </div>

          <div class="metric">
            <div class="metric__head"><span>Length</span><strong id="mLength">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bLength"></div></div>
          </div>

          <div class="metric metric--wide">
            <div class="metric__head"><span>Parseable</span><strong id="mParseable">—%</strong></div>
            <div class="bar"><div class="bar__fill" id="bParseable"></div></div>
          </div>
        </div>

      <footer class="score-card__foot">
        <p class="metric-note" id="metric-note">Last analyzed: —</p>
        <small>Higher is better. Aim for green across the board.</small>
      </footer>
    </article>
  </div>

  <div id="no-analysis-cta" class="no-analysis" style="display:none;">
    <p>You haven’t analyzed a resume yet. Use the upload panel above to get started.</p>
  </div>

  <!-- OPTIMIZE -->
  <section class="opt-shell">
    <aside class="opt-nav" aria-label="Optimize menu">
      <button class="opt-btn is-active" data-view="fixes">Fixes needed</button>
      <button class="opt-btn" data-view="done">Done well</button>
      <button class="opt-btn" data-view="keywords">ATS keywords</button>
      <button class="opt-btn" data-view="writing">Writing quality</button>
      <button class="opt-btn" data-view="recs">Recommendations</button>
    </aside>

    <div class="opt-panel" id="optPanel"></div>
  </section>

  <!-- Recommendation CTA -->
  <section class="opt-cta">
    <p class="opt-explain">
      Use the recommendations above to update your resume, or utilise our special resume builder feature to create a new one.
    </p>
  
    <div class="actions" style="display:flex;gap:.75rem;flex-wrap:wrap;">
      <a id="rebuild-ai-btn" class="btn btn-primary" href="/resume-builder">Rebuild with AI</a>
    </div>
  
    <small class="help">“Rebuild with AI” opens the Resume Builder page.</small>
  </section>
</section>
{% endblock %}

{% block scripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.1/docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
