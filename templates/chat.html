<!-- templates/chat.html -->
{% extends "base.html" %}

{% block title %}Chat with Jobcus{% endblock %}
{% block body_class %}chat-page{% endblock %}

{% block header_icon %}
  <img
    src="{{ url_for('static', filename='icons/pencilchat.svg') }}"
    class="header-pencil-icon"
    alt="New Chat"
    title="Start a new chat"
    onclick="clearChat()"
  />
{% endblock %}

{% set show_footer = false %}

{% block content %}
<main id="mainContainer">
  <div class="chat-wrapper">
    <div class="chatbox" id="chatbox">
      <!-- Welcome banner + suggestions -->
      <div id="welcomeBanner" style="
           padding:24px 16px;
           background:#fff;
           text-align:center;
         ">
        {% if current_user.is_authenticated and current_user.first_name %}
          <p style="
             font-size:1.5rem;
             font-weight:600;
             margin:0 0 16px;
             color:#104879;
           ">
            👋 Welcome {{ current_user.first_name }}! How can I help you today?
          </p>
        {% else %}
          <p style="
             font-size:1.5rem;
             font-weight:600;
             margin:0 0 16px;
             color:#104879;
           ">
            👋 Welcome! How can I help you today?
          </p>
        {% endif %}

        <div class="suggestion-chips" style="
             display:flex;
             flex-wrap:wrap;
             justify-content:center;
             gap:12px;
           ">
          <button type="button" onclick="insertSuggestion('How do I improve my resume?')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Improve my resume
          </button>
          <button type="button" onclick="insertSuggestion('Interview tips for a UX role')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Interview tips
          </button>
          <button type="button" onclick="insertSuggestion('Show me job market insights for London')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Job insights
          </button>
        </div>
      </div>
    </div>
    <div id="job-results" class="job-results"></div>
  </div>

  <form id="chat-form">
    <div class="input-container" id="inputContainer">
      <textarea
        id="userInput"
        rows="1"
        placeholder="Ask your career question..."
        oninput="autoResize(this)"
      ></textarea>
      <div class="icon-group" style="align-items: right;">
        <label for="file-upload">
          <img src="{{ url_for('static', filename='icons/attach.svg') }}" alt="Attach">
        </label>
        <input
          id="file-upload"
          type="file"
          style="display: none;"
          onchange="handleAttach()"
        >
        <img
          src="{{ url_for('static', filename='icons/mic.svg') }}"
          alt="Mic"
          onclick="handleMic()"
        >
        <img
          id="sendButton"
          src="{{ url_for('static', filename='icons/send.svg') }}"
          alt="Send"
        >
      </div>
    </div>
  </form>

  <img
    id="scrollDown"
    class="scroll-down-icon"
    src="{{ url_for('static', filename='icons/scrolldown.svg') }}"
    alt="Scroll Down"
    onclick="scrollToBottom()"
  />
  
  <section id="credits-info" class="credits-panel" aria-labelledby="credits-title">
  <h2 id="credits-title">AI Chat credits & fair-use</h2>

  <div class="credits-row">
    <div>
      <div class="credits-label">Your plan</div>
      <strong id="credits-plan">Free</strong>
    </div>
    <div>
      <div class="credits-label">Messages left</div>
      <strong id="credits-left">—</strong>
      <small id="credits-reset" class="credits-hint">Resets monthly</small>
    </div>
  </div>

  <details class="credits-details">
    <summary>How credits work</summary>
    <ul>
      <li><strong>Free:</strong> 15 total messages (trial)</li>
      <li><strong>Weekly Pass:</strong> 200 messages / week</li>
      <li><strong>Standard:</strong> 800 messages / month</li>
      <li><strong>Premium:</strong> 12,000 messages / year (~1,000 / mo)</li>
    </ul>
    <p>A “message” is each prompt you send to Jobcus. When you run out, chat may pause until your next reset or upgrade.</p>
    <p><em>“Unlimited”</em> features (e.g., resume analyses) follow fair-use limits to keep the service fast for everyone.</p>
  </details>
</section>

</main>
{% endblock %}

{% block scripts %}
  <!-- in the <head> or right before chat.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
