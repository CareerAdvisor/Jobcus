<!-- templates/chat.html -->
{% extends "base.html" %}

{% block title %}Chat with Jobcus{% endblock %}
{% block body_class %}chat-page{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block header_icon %}
  <img
    src="{{ url_for('static', filename='icons/pencilchat.svg') }}"
    class="header-pencil-icon"
    alt="New Chat"
    title="Start a new chat"
    onclick="clearChat()"
  />

  <!-- Chat Menu toggle (only exists on chat page) -->
  <button id="chatMenuBtn"
          class="header-menu-icon"
          aria-haspopup="dialog"
          aria-expanded="false"
          aria-controls="chatMenu"
          title="Chat menu">
    <img src="{{ url_for('static', filename='icons/sidebar.svg') }}" alt="Menu">
  </button>
{% endblock %}


{% set show_footer = false %}

{% block content %}
<main id="mainContainer">
  <div class="chat-wrapper">
    <div class="chatbox" id="chatbox">
      <!-- Welcome banner + suggestions -->
      <div id="welcomeBanner" style="
           padding:24px 16px;
           background:#fff;
           text-align:center;
         ">
        {% if current_user.is_authenticated and current_user.first_name %}
          <p style="
             font-size:1.5rem;
             font-weight:600;
             margin:0 0 16px;
             color:#104879;
           ">
            üëã Welcome {{ current_user.first_name }}! How can I help you today?
          </p>
        {% else %}
          <p style="
             font-size:1.5rem;
             font-weight:600;
             margin:0 0 16px;
             color:#104879;
           ">
            üëã Welcome! How can I help you today?
          </p>
        {% endif %}

        <div class="suggestion-chips" style="
             display:flex;
             flex-wrap:wrap;
             justify-content:center;
             gap:12px;
           ">
          <button type="button" onclick="insertSuggestion('How do I improve my resume?')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Improve my resume
          </button>
          <button type="button" onclick="insertSuggestion('Interview tips for a UX role')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Interview tips
          </button>
          <button type="button" onclick="insertSuggestion('Show me job market insights for London')" style="
             padding:10px 20px;
             border:none;
             border-radius:20px;
             background:#104879;
             color:#fff;
             font-size:1rem;
             font-weight:500;
             white-space:nowrap;
             cursor:pointer;
           ">
            Job insights
          </button>
        </div>
      </div>
    </div>
    <div id="job-results" class="job-results"></div>
  </div>

  <!-- Off-canvas Chat Menu -->
<aside id="chatMenu" class="chat-menu" role="dialog" aria-modal="true" aria-labelledby="chatMenuTitle" hidden>
  <header class="chat-menu__header">
    <h2 id="chatMenuTitle">Chat menu</h2>
    <button id="chatMenuClose" class="chat-menu__close" aria-label="Close menu">√ó</button>
  </header>

  <div class="chat-menu__body">
    <!-- Compact credits panel (reuses your refreshCreditsPanel code) -->
    <section class="credits-panel" aria-live="polite">
      <h3 class="credits-panel__title">AI Chat credits</h3>
      <div class="credits-row">
        <div>
          <span class="credits-label">Plan</span>
          <strong id="credits-plan">‚Äî</strong>
        </div>
        <div>
          <span class="credits-label">Messages left</span>
          <strong id="credits-left">‚Äî</strong>
          <small id="credits-reset" class="credits-hint"></small>
        </div>
      </div>

      <details class="credits-details">
        <summary>How credits work</summary>
        <ul>
          <li><b>Free:</b> 15 total messages (trial)</li>
          <li><b>Weekly:</b> 200 / week</li>
          <li><b>Standard:</b> 800 / month</li>
          <li><b>Premium:</b> 12,000 / year (~1,000 / mo)</li>
        </ul>
        <p class="credits-note">A ‚Äúmessage‚Äù counts each prompt you send.</p>
      </details>
    </section>

    <nav class="chat-menu__links">
      <a href="/pricing">View pricing</a>
      <a href="/dashboard">Back to dashboard</a>
      <button type="button" onclick="clearChat()">Clear conversation</button>
    </nav>
  </div>
</aside>

<!-- Dim background when menu is open -->
<div id="chatMenuOverlay" class="chat-menu__overlay" hidden></div>

  <form id="chat-form">
    <div class="input-container" id="inputContainer">
      <textarea
        id="userInput"
        rows="1"
        placeholder="Ask your career question..."
        oninput="autoResize(this)"
      ></textarea>
      <div class="icon-group" style="align-items: right;">
        <label for="file-upload">
          <img src="{{ url_for('static', filename='icons/attach.svg') }}" alt="Attach">
        </label>
        <input
          id="file-upload"
          type="file"
          style="display: none;"
          onchange="handleAttach()"
        >
        <img
          src="{{ url_for('static', filename='icons/mic.svg') }}"
          alt="Mic"
          onclick="handleMic()"
        >
        <img
          id="sendButton"
          src="{{ url_for('static', filename='icons/send.svg') }}"
          alt="Send"
        >
      </div>
    </div>
  </form>

  <img
    id="scrollDown"
    class="scroll-down-icon"
    src="{{ url_for('static', filename='icons/scrolldown.svg') }}"
    alt="Scroll Down"
    onclick="scrollToBottom()"
  />

</main>
{% endblock %}

{% block scripts %}
  <!-- in the <head> or right before chat.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
