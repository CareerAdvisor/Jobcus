{% extends "base.html" %}
{% block title %}Chat with Jobcus{% endblock %}
{% block body_class %}chat-page{% endblock %}

{# Left “sidebar” toggle icon in the header #}
{% block header_icon %}
  <img
    id="chatMenuToggle"
    src="{{ url_for('static', filename='icons/sidebar.svg') }}"
    class="header-menu-icon"
    alt="Open chat menu"
    title="Menu"
  />
{% endblock %}

{% set show_footer = false %}

{% block content %}
<main id="mainContainer">

  {# —— Left slide-in chat menu —— #}
  <aside id="chatMenu" class="chat-menu" aria-label="Chat menu" aria-hidden="true">
    <header class="chat-menu__top">
      <strong>Chat menu</strong>
      <button id="chatMenuClose" class="chat-menu__close" aria-label="Close">×</button>
    </header>

    <nav class="chat-menu__nav">
      <button id="newChatBtn" class="menu-btn">
        <img src="{{ url_for('static', filename='icons/pencilchat.svg') }}" alt="" />
        New chat
      </button>
      <a class="menu-btn" href="/pricing">View pricing</a>
      <a class="menu-btn" href="/dashboard">Back to dashboard</a>
      <button id="clearChatBtn" class="menu-btn destructive">Clear conversation</button>
    </nav>

    <section class="credits-card">
      <div class="credits-card__head">AI Chat credits</div>
      <div class="credits-card__row">
        <div>
          <div class="credits-label">Plan</div>
          <strong id="credits-plan">Free</strong>
        </div>
        <div>
          <div class="credits-label">Messages left</div>
          <strong id="credits-left">—</strong>
          <small id="credits-reset" class="credits-hint">Resets monthly</small>
        </div>
      </div>

      <details class="credits-details">
        <summary>How credits work</summary>
        <ul>
          <li><strong>Free:</strong> 15 total messages (trial)</li>
          <li><strong>Weekly:</strong> 200 / week</li>
          <li><strong>Standard:</strong> 800 / month</li>
          <li><strong>Premium:</strong> 12,000 / year (~1,000 / mo)</li>
        </ul>
        <p>A “message” is each prompt you send. When you run out, chat pauses until your next reset or upgrade.</p>
      </details>
    </section>
  </aside>
  <div id="chatOverlay" class="chat-menu__overlay" hidden></div>
  {# ———————————————— #}

  <div class="chat-wrapper">
    <div class="chatbox" id="chatbox">
      <!-- Welcome banner + suggestions (unchanged) -->
      <div id="welcomeBanner" class="welcome-banner">
        {% if current_user.is_authenticated and current_user.first_name %}
          <p class="welcome-title">👋 Welcome {{ current_user.first_name }}! How can I help you today?</p>
        {% else %}
          <p class="welcome-title">👋 Welcome! How can I help you today?</p>
        {% endif %}
        <div class="suggestion-chips">
          <button type="button" onclick="insertSuggestion('How do I improve my resume?')">Improve my resume</button>
          <button type="button" onclick="insertSuggestion('Interview tips for a UX role')">Interview tips</button>
          <button type="button" onclick="insertSuggestion('Show me job market insights for London')">Job insights</button>
        </div>
      </div>
    </div>
    <div id="job-results" class="job-results"></div>
  </div>

  {# NOTE: the old inline <section id="credits-info"> was removed — it now lives in the left menu #}

  <form id="chat-form">
    <div class="input-container" id="inputContainer">
      <textarea
        id="userInput"
        rows="1"
        placeholder="Ask your career question..."
        oninput="autoResize(this)"
      ></textarea>
      <div class="icon-group">
        <label for="file-upload"><img src="{{ url_for('static', filename='icons/attach.svg') }}" alt="Attach"></label>
        <input id="file-upload" type="file" hidden onchange="handleAttach()">
        <img src="{{ url_for('static', filename='icons/mic.svg') }}" alt="Mic" onclick="handleMic()">
        <img id="sendButton" src="{{ url_for('static', filename='icons/send.svg') }}" alt="Send">
      </div>
    </div>
  </form>

  <img id="scrollDown" class="scroll-down-icon" src="{{ url_for('static', filename='icons/scrolldown.svg') }}" alt="Scroll Down" onclick="scrollToBottom()" />
</main>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
